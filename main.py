import random
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.filters import Command
from aiogram.types import FSInputFile

TOKEN = ""
MEME_PATH = "mem.jpg"  # Путь к мему

bot = Bot(token=TOKEN)
dp = Dispatcher()

# 200 вопросов с вариантами ответа
questions = [
    ("Чему равен квадрат числа 12?", ["124", "144", "112", "132"], "144"),
    ("Как называется сумма всех сторон многоугольника?", ["Радиус", "Диагональ", "Периметр", "Площадь"], "Периметр"),
    ("Сколько градусов в прямом угле?", ["180", "90", "60", "45"], "90"),
    ("Какой химический символ у золота?", ["Au", "Ag", "Pb", "Fe"], "Au"),
    ("Кто написал 'Войну и мир'?", ["Толстой", "Достоевский", "Пушкин", "Гоголь"], "Толстой"),
    ("Какая планета ближе всего к Солнцу?", ["Марс", "Венера", "Меркурий", "Юпитер"], "Меркурий"),
    ("Как измеряется сила?", ["Ватт", "Ньютон", "Паскаль", "Ом"], "Ньютон"),
    ("Как называется орган, перекачивающий кровь в организме человека?", ["Легкие", "Сердце", "Желудок", "Печень"], "Сердце"),
    ("Какая самая длинная река в мире?", ["Амазонка", "Нил", "Янцзы", "Волга"], "Нил"),
    ("Кто написал 'Преступление и наказание'?", ["Толстой", "Достоевский", "Чехов", "Гоголь"], "Достоевский"),
    ("Какая самая высокая гора в мире?", ["Эльбрус", "Эверест", "Килиманджаро", "Монблан"], "Эверест"),
    ("Как называется столица Франции?", ["Берлин", "Лондон", "Мадрид", "Париж"], "Париж"),
    ("Сколько ног у паука?", ["6", "8", "10", "12"], "8"),
    ("Как называется наука о звездах и планетах?", ["Астрономия", "Геология", "Биология", "Физика"], "Астрономия"),
    ("Как называется основной источник энергии на Земле?", ["Луна", "Солнце", "Ветер", "Океан"], "Солнце"),
    ("Какой газ необходим для дыхания человека?", ["Азот", "Кислород", "Углекислый газ", "Водород"], "Кислород"),
    ("Сколько планет в Солнечной системе?", ["7", "8", "9", "10"], "8"),
    ("Кто написал 'Горе от ума'?", ["Грибоедов", "Пушкин", "Лермонтов", "Толстой"], "Грибоедов"),
    ("Какой металл самый легкий?", ["Алюминий", "Литий", "Железо", "Золото"], "Литий"),
    ("Какая единица измеряет силу тока?", ["Ом", "Ампер", "Вольт", "Джоуль"], "Ампер"),
    ("Кто первым полетел в космос?", ["Нил Армстронг", "Юрий Гагарин", "Алексей Леонов", "Герман Титов"], "Юрий Гагарин"),
    ("Как называется наука, изучающая растения?", ["Зоология", "Ботаника", "Экология", "Генетика"], "Ботаника"),
    ("В каком году началась Вторая мировая война?", ["1939", "1941", "1914", "1945"], "1939"),
    ("Какая планета известна как Красная планета?", ["Земля", "Марс", "Юпитер", "Венера"], "Марс"),
    ("Кто написал 'Ревизор'?", ["Гоголь", "Достоевский", "Толстой", "Чехов"], "Гоголь"),
    ("Как называется столица России?", ["Киев", "Москва", "Санкт-Петербург", "Минск"], "Москва"),
    ("Кто создал таблицу Менделеева?", ["Эйнштейн", "Менделеев", "Ньютон", "Ломоносов"], "Менделеев"),
    ("Какой континент самый холодный?", ["Европа", "Азия", "Антарктида", "Северная Америка"], "Антарктида"),
    ("Какая основная функция хлорофилла в растениях?", ["Фотосинтез", "Дыхание", "Рост", "Размножение"], "Фотосинтез"),
    ("Какой результат умножения 7 × 8?", ["48", "54", "56", "64"], "56"),
    ("Чему равно 3! (факториал трёх)?", ["3", "6", "9", "12"], "6"),
    ("Какое число является нейтральным в сложении?", ["0", "-0", "1", "-1"], "0"),
    ("Как называется число, которое делится только на 1 и само себя?", ["Простое", "Дробное", "Составное", "Отрицательное"], "Простое"),
    ("Сколько нулей в миллионе?", ["3", "6", "9", "12"], "6"),
    ("Как называется фигура с тремя сторонами?", ["Квадрат", "Треугольник", "Круг", "Овал"], "Треугольник"),
    ("Чему равно 2³?", ["2", "6", "8", "12"], "8"),
    ("Как называется прямая, которая пересекает окружность в двух точках?", ["Секущая", "Хорда", "Радиус", "Касательная"], "Секущая"),
    ("Сколько сторон у шестиугольника?", ["3", "6", "9", "12"], "6"),
    ("Как называется число, делящееся на 2 без остатка?", ["Простое", "Четное", "Нечетное", "Дробное"], "Четное"),
    ("Сколько будет 25% от 200?", ["25", "50", "75", "40"], "50"),
    ("Что быстрее: свет или звук?", ["Свет", "Звук", "Одинаковое", "Зависит от пространства"], "Свет"),
    ("Кто открыл закон всемирного тяготения?", ["Эйнштейн", "Ньютон", "Архимед", "Паскаль"], "Ньютон"),
    ("Как называется вещество, которое притягивает железо?", ["Магнит", "Проводник", "Диэлектрик", "Полупроводник"], "Магнит"),
    ("Какая планета солнечной системы самая большая?", ["Земля", "Марс", "Юпитер", "Венера"], "Юпитер"),
    ("Какая единица измеряет электрический заряд?", ["ОМ", "Кулон", "Паскаль", "Джоуль"], "Кулон"),
    ("Что такое абсолютный ноль в градусах Цельсия?", ["-100", "-273°C", "0", "273"], "-273°C"),
    ("Как называется явление отражения звука?", ["Эхо", "Резонанс", "Интерференция", "Дисперсия"], "Эхо"),
    ("Что измеряется в амперах?", ["Напряжение", "Сила тока", "Мощность", "Сопротивление"], "Сила тока"),
    ("Какая физическая величина измеряется в паскалях?", ["Давление", "Время", "Энергия", "Скорость"], "Давление"),
    ("Как обозначается химический элемент кислород?", ["О", "К", "Н", "С"], "О"),
    ("Какая формула воды?", ["CO₂", "H₂O", "O₂", "CH₄"], "H₂O"),
    ("Какой газ мы вдыхаем из воздуха?", ["Азот", "Кислород", "Углекислый газ", "Водород"], "Кислород"),
    ("Какой химический элемент обозначается Na?", ["Натрий", "Ртуть", "Неон", "Кальций"], "Натрий"),
    ("Какая кость самая длинная в теле человека?", ["Плечевая", "Бедренная", "Берцовая", "Челюстная"], "Бедренная"),
    ("Какой океан самый большой?", ["Тихий", "Северный Ледовитый", "Индийский", "Атлантический"], "Тихий"),
    ("Какой русский царь отменил крепостное право?", ["Иван Грозный", "Александр II", "Николай II", "Петр I"], "Александр II"),
    ("Кто написал «Преступление и наказание»?", ["Толстой", "Достоевский", "Чехов", "Гоголь"], "Достоевский"),
    ("Кто автор «Евгения Онегина»?", ["Пушкин", "Лермонтов", "Гоголь", "Тургенев"], "Пушкин"),
    ("Какая книга начинается словами «Все счастливые семьи похожи друг на друга…»?", ["Война и мир", "Анна Каренина", "Преступление и наказание", "Отцы и дети"], "Анна Каренина"),
]

random.shuffle(questions)
user_progress = {}

# Функция создания клавиатуры
def get_keyboard(options):
    return ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text=option)] for option in options],
        resize_keyboard=True
    )

@dp.message(Command("start"))
async def start_quiz(message: types.Message):
    user_progress[message.from_user.id] = 0
    await ask_question(message.from_user.id, message.chat.id)

async def ask_question(user_id, chat_id):
    question_num = user_progress[user_id]
    if question_num >= len(questions):  
        meme = FSInputFile(MEME_PATH)  # Отправляем мем
        await bot.send_photo(chat_id, meme, caption="На что ты потратил эти часы? 😂")
        return
    
    question, options, _ = questions[question_num]
    await bot.send_message(chat_id, f"Вопрос {question_num + 1}: {question}", reply_markup=get_keyboard(options))

@dp.message()
async def handle_answer(message: types.Message):
    user_id = message.from_user.id

    if user_id not in user_progress:
        await start_quiz(message)
        return

    question_num = user_progress[user_id]
    correct_answer = questions[question_num][2]

    if message.text == correct_answer:
        user_progress[user_id] += 1
        if user_progress[user_id] < len(questions):
            await ask_question(user_id, message.chat.id)
        else:
            meme = FSInputFile(MEME_PATH)
            await bot.send_photo(message.chat.id, meme, caption="На что ты потратил эти часы? 😂")
            del user_progress[user_id]
    else:
        await bot.send_message(message.chat.id, "Неверно! Начинаем заново!")
        user_progress[user_id] = 0
        await asyncio.sleep(2)
        await ask_question(user_id, message.chat.id)

async def main():
    await bot.delete_webhook(drop_pending_updates=True)
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
